{% extends 'board/base.html' %}

{% block title %}{{ page_title }} - NestOn{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1 class="page-title">⚙️ {{ page_title }}</h1>
        <p class="page-subtitle">{{ page_subtitle }}</p>
    </div>
    
    <div class="page-content">
        <div class="interests-container">
            <!-- 현재 설정된 관심사 -->
            <div class="current-interests">
                <h3>현재 설정된 관심사</h3>
                <div class="current-list">
                    <div class="interest-item active">
                        <div class="interest-icon">🎭</div>
                        <div class="interest-name">문화/예술</div>
                        <button class="remove-btn" onclick="removeInterest('문화/예술')">제거</button>
                    </div>
                    <div class="interest-item active">
                        <div class="interest-icon">🏃‍♂️</div>
                        <div class="interest-name">체육/운동</div>
                        <button class="remove-btn" onclick="removeInterest('체육/운동')">제거</button>
                    </div>
                    <div class="interest-item active">
                        <div class="interest-icon">🍽️</div>
                        <div class="interest-name">음식/맛집</div>
                        <button class="remove-btn" onclick="removeInterest('음식/맛집')">제거</button>
                    </div>
                    <div class="interest-item active">
                        <div class="interest-icon">🛍️</div>
                        <div class="interest-name">쇼핑/상권</div>
                        <button class="remove-btn" onclick="removeInterest('쇼핑/상권')">제거</button>
                    </div>
                </div>
            </div>
            
            <!-- 관심사 추가 -->
            <div class="add-interests">
                <h3>관심사 추가</h3>
                <div class="available-interests">
                    <div class="interest-item inactive" onclick="addInterest('미술/디자인', '🎨')">
                        <div class="interest-icon">🎨</div>
                        <div class="interest-name">미술/디자인</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('음악/공연', '🎵')">
                        <div class="interest-icon">🎵</div>
                        <div class="interest-name">음악/공연</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('스포츠', '⚽')">
                        <div class="interest-icon">⚽</div>
                        <div class="interest-name">스포츠</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('건강/의료', '🏥')">
                        <div class="interest-icon">🏥</div>
                        <div class="interest-name">건강/의료</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('교육/강연', '🎓')">
                        <div class="interest-icon">🎓</div>
                        <div class="interest-name">교육/강연</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('환경/생태', '🌱')">
                        <div class="interest-icon">🌱</div>
                        <div class="interest-name">환경/생태</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('기술/IT', '💻')">
                        <div class="interest-icon">💻</div>
                        <div class="interest-name">기술/IT</div>
                        <button class="add-btn">추가</button>
                    </div>
                    <div class="interest-item inactive" onclick="addInterest('여행/레저', '✈️')">
                        <div class="interest-icon">✈️</div>
                        <div class="interest-name">여행/레저</div>
                        <button class="add-btn">추가</button>
                    </div>
                </div>
            </div>
            
            <!-- 관심사 우선순위 설정 -->
            <div class="priority-settings">
                <h3>관심사 우선순위 설정</h3>
                <div class="priority-list" id="priorityList">
                    <div class="priority-item" data-interest="문화/예술">
                        <div class="priority-number">1</div>
                        <div class="interest-icon">🎭</div>
                        <div class="interest-name">문화/예술</div>
                        <div class="priority-controls">
                            <button class="priority-btn" onclick="movePriority(this, 'up')">↑</button>
                            <button class="priority-btn" onclick="movePriority(this, 'down')">↓</button>
                        </div>
                    </div>
                    <div class="priority-item" data-interest="체육/운동">
                        <div class="priority-number">2</div>
                        <div class="interest-icon">🏃‍♂️</div>
                        <div class="interest-name">체육/운동</div>
                        <div class="priority-controls">
                            <button class="priority-btn" onclick="movePriority(this, 'up')">↑</button>
                            <button class="priority-btn" onclick="movePriority(this, 'down')">↓</button>
                        </div>
                    </div>
                    <div class="priority-item" data-interest="음식/맛집">
                        <div class="priority-number">3</div>
                        <div class="interest-icon">🍽️</div>
                        <div class="interest-name">음식/맛집</div>
                        <div class="priority-controls">
                            <button class="priority-btn" onclick="movePriority(this, 'up')">↑</button>
                            <button class="priority-btn" onclick="movePriority(this, 'down')">↓</button>
                        </div>
                    </div>
                    <div class="priority-item" data-interest="쇼핑/상권">
                        <div class="priority-number">4</div>
                        <div class="interest-icon">🛍️</div>
                        <div class="interest-name">쇼핑/상권</div>
                        <div class="priority-controls">
                            <button class="priority-btn" onclick="movePriority(this, 'up')">↑</button>
                            <button class="priority-btn" onclick="movePriority(this, 'down')">↓</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 알림 설정 -->
            <div class="notification-settings">
                <h3>관심사별 알림 설정</h3>
                <div class="notification-list">
                    <div class="notification-item">
                        <div class="notification-info">
                            <div class="interest-icon">🎭</div>
                            <div class="interest-name">문화/예술</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="notification-item">
                        <div class="notification-info">
                            <div class="interest-icon">🏃‍♂️</div>
                            <div class="interest-name">체육/운동</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="notification-item">
                        <div class="notification-info">
                            <div class="interest-icon">🍽️</div>
                            <div class="interest-name">음식/맛집</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="notification-item">
                        <div class="notification-info">
                            <div class="interest-icon">🛍️</div>
                            <div class="interest-name">쇼핑/상권</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- 저장 버튼 -->
            <div class="save-actions">
                <button class="btn-secondary" onclick="goBack()">취소</button>
                <button class="btn-primary" onclick="saveChanges()">변경사항 저장</button>
            </div>
            
            <div class="info-box">
                <h4>💡 관심사 설정 안내</h4>
                <ul>
                    <li>최대 6개까지 관심사를 설정할 수 있습니다.</li>
                    <li>우선순위가 높은 관심사의 소식과 행사를 먼저 받아볼 수 있습니다.</li>
                    <li>알림 설정을 통해 각 관심사별로 알림을 받을지 선택할 수 있습니다.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
    .interests-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .current-interests, .add-interests, .priority-settings, .notification-settings {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .current-interests h3, .add-interests h3, .priority-settings h3, .notification-settings h3 {
        margin-bottom: 20px;
        color: #2c3e50;
        font-size: 1.3em;
        border-bottom: 2px solid #4facfe;
        padding-bottom: 10px;
    }
    
    .current-list, .available-interests {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }
    
    .interest-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px;
        border-radius: 10px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .interest-item.active {
        background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%);
        border-color: #4facfe;
    }
    
    .interest-item.inactive {
        background: #f8f9fa;
        border-color: #e1e5e9;
    }
    
    .interest-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .interest-icon {
        font-size: 1.5em;
    }
    
    .interest-name {
        flex: 1;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .remove-btn, .add-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8em;
        transition: all 0.3s ease;
    }
    
    .remove-btn {
        background: #e74c3c;
        color: white;
    }
    
    .add-btn {
        background: #2ecc71;
        color: white;
    }
    
    .remove-btn:hover, .add-btn:hover {
        transform: translateY(-1px);
    }
    
    .priority-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .priority-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #4facfe;
    }
    
    .priority-number {
        width: 30px;
        height: 30px;
        background: #4facfe;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9em;
    }
    
    .priority-controls {
        display: flex;
        gap: 5px;
    }
    
    .priority-btn {
        width: 30px;
        height: 30px;
        border: none;
        background: #e1e5e9;
        color: #666;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .priority-btn:hover {
        background: #4facfe;
        color: white;
    }
    
    .notification-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .notification-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .notification-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    /* 토글 스위치 스타일 */
    .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }
    
    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    input:checked + .slider {
        background-color: #4facfe;
    }
    
    input:checked + .slider:before {
        transform: translateX(26px);
    }
    
    .save-actions {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        margin-bottom: 30px;
    }
    
    .btn-primary, .btn-secondary {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
    }
    
    .btn-primary {
        background: #4facfe;
        color: white;
    }
    
    .btn-primary:hover {
        background: #3a8bfd;
        transform: translateY(-2px);
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
        transform: translateY(-2px);
    }
    
    .info-box {
        background: #e8f4fd;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #4facfe;
    }
    
    .info-box h4 {
        margin-bottom: 10px;
        color: #2c3e50;
        font-size: 1.1em;
    }
    
    .info-box ul {
        margin: 0;
        padding-left: 20px;
        color: #555;
        font-size: 0.9em;
        line-height: 1.6;
    }
    
    .info-box li {
        margin-bottom: 5px;
    }
    
    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: 600;
    }
    
    .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>

<script>
    // 관심사 추가
    function addInterest(name, icon) {
        const currentCount = document.querySelectorAll('.interest-item.active').length;
        
        if (currentCount >= 6) {
            alert('최대 6개까지 관심사를 설정할 수 있습니다.');
            return;
        }
        
        // 현재 관심사 목록에 추가
        const currentList = document.querySelector('.current-list');
        const newItem = document.createElement('div');
        newItem.className = 'interest-item active';
        newItem.innerHTML = `
            <div class="interest-icon">${icon}</div>
            <div class="interest-name">${name}</div>
            <button class="remove-btn" onclick="removeInterest('${name}')">제거</button>
        `;
        currentList.appendChild(newItem);
        
        // 우선순위 목록에 추가
        const priorityList = document.getElementById('priorityList');
        const priorityItem = document.createElement('div');
        priorityItem.className = 'priority-item';
        priorityItem.dataset.interest = name;
        priorityItem.innerHTML = `
            <div class="priority-number">${currentCount + 1}</div>
            <div class="interest-icon">${icon}</div>
            <div class="interest-name">${name}</div>
            <div class="priority-controls">
                <button class="priority-btn" onclick="movePriority(this, 'up')">↑</button>
                <button class="priority-btn" onclick="movePriority(this, 'down')">↓</button>
            </div>
        `;
        priorityList.appendChild(priorityItem);
        
        // 알림 설정에 추가
        const notificationList = document.querySelector('.notification-list');
        const notificationItem = document.createElement('div');
        notificationItem.className = 'notification-item';
        notificationItem.innerHTML = `
            <div class="notification-info">
                <div class="interest-icon">${icon}</div>
                <div class="interest-name">${name}</div>
            </div>
            <label class="switch">
                <input type="checkbox" checked>
                <span class="slider"></span>
            </label>
        `;
        notificationList.appendChild(notificationItem);
        
        // 원본 아이템 비활성화
        event.target.closest('.interest-item').classList.remove('inactive');
        event.target.closest('.interest-item').classList.add('active');
        event.target.textContent = '추가됨';
        event.target.disabled = true;
        
        updatePriorityNumbers();
    }
    
    // 관심사 제거
    function removeInterest(name) {
        if (confirm(`${name} 관심사를 제거하시겠습니까?`)) {
            // 현재 관심사 목록에서 제거
            const currentItem = event.target.closest('.interest-item');
            currentItem.remove();
            
            // 우선순위 목록에서 제거
            const priorityItem = document.querySelector(`[data-interest="${name}"]`);
            if (priorityItem) {
                priorityItem.remove();
            }
            
            // 알림 설정에서 제거
            const notificationItems = document.querySelectorAll('.notification-item');
            notificationItems.forEach(item => {
                if (item.querySelector('.interest-name').textContent === name) {
                    item.remove();
                }
            });
            
            // 사용 가능한 관심사에서 다시 활성화
            const availableItems = document.querySelectorAll('.available-interests .interest-item');
            availableItems.forEach(item => {
                if (item.querySelector('.interest-name').textContent === name) {
                    item.classList.remove('active');
                    item.classList.add('inactive');
                    const addBtn = item.querySelector('.add-btn');
                    addBtn.textContent = '추가';
                    addBtn.disabled = false;
                }
            });
            
            updatePriorityNumbers();
        }
    }
    
    // 우선순위 이동
    function movePriority(btn, direction) {
        const priorityItem = btn.closest('.priority-item');
        const priorityList = document.getElementById('priorityList');
        
        if (direction === 'up' && priorityItem.previousElementSibling) {
            priorityList.insertBefore(priorityItem, priorityItem.previousElementSibling);
        } else if (direction === 'down' && priorityItem.nextElementSibling) {
            priorityList.insertBefore(priorityItem.nextElementSibling, priorityItem);
        }
        
        updatePriorityNumbers();
    }
    
    // 우선순위 번호 업데이트
    function updatePriorityNumbers() {
        const priorityItems = document.querySelectorAll('.priority-item');
        priorityItems.forEach((item, index) => {
            item.querySelector('.priority-number').textContent = index + 1;
        });
    }
    
    // 변경사항 저장
    function saveChanges() {
        // 실제 API 호출 대신 시뮬레이션
        showAlert('관심사 설정이 성공적으로 저장되었습니다!', 'success');
        
        setTimeout(() => {
            window.location.href = '/board/myinterests/';
        }, 2000);
    }
    
    // 알림 표시
    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;
        
        const container = document.querySelector('.interests-container');
        container.insertBefore(alertDiv, container.firstChild);
        
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }
    
    // 뒤로 가기
    function goBack() {
        window.history.back();
    }
</script>
{% endblock %}
